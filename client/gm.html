<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daggerheart VTT - GM View</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .gm-layout {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 1rem;
            height: 100vh;
            padding: 1rem;
        }
        
        .gm-sidebar {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .gm-main {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .control-panel {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .save-panel {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .saves-list {
            max-height: 200px;
            overflow-y: auto;
            background: var(--bg-medium);
            border-radius: 4px;
            padding: 0.5rem;
        }
        
        .save-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--bg-dark);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .save-item:hover {
            background: var(--accent);
            transform: translateX(4px);
        }
        
        .player-list-gm {
            margin-top: 1rem;
        }
        
        .player-item-gm {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: var(--bg-medium);
            border-radius: 4px;
            border-left: 4px solid var(--accent);
        }
        
        .player-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }
        
        .stat {
            background: var(--bg-dark);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.85rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-offline {
            background: #6b7280;
        }
    </style>
</head>
<body>
    <div class="gm-layout">
        <!-- Left Sidebar: Session Controls -->
        <aside class="gm-sidebar">
            <h2>ğŸ® Session Control</h2>
            
            <div class="control-panel">
                <h3>Save/Load</h3>
                <div class="save-panel">
                    <button id="save-btn" class="btn-primary">ğŸ’¾ Save</button>
                    <button id="refresh-saves-btn" class="btn-secondary">ğŸ”„</button>
                </div>
                
                <div class="saves-list" id="saves-list">
                    <p class="empty-state">No saves yet</p>
                </div>
            </div>
            
            <div class="control-panel" style="margin-top: 1rem;">
                <h3>Session Info</h3>
                <div id="session-info">
                    <p><strong>Players:</strong> <span id="player-count">0</span></p>
                    <p><strong>Characters:</strong> <span id="character-count">0</span></p>
                    <p><strong>Status:</strong> <span id="session-status">Active</span></p>
                </div>
            </div>
            
            <div class="control-panel" style="margin-top: 1rem;">
                <h3>Quick Actions</h3>
                <button id="clear-stress-all" class="btn-secondary btn-small" style="width: 100%; margin-bottom: 0.5rem;">Clear All Stress</button>
                <button id="refresh-clients" class="btn-secondary btn-small" style="width: 100%;">Refresh Clients</button>
            </div>
            
            <div class="control-panel" style="margin-top: 1rem;">
                <h3>ğŸ² Request Roll</h3>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-target" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Target:</label>
                    <select id="roll-target" class="input-field" style="width: 100%;">
                        <option value="all">All Players</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-attribute" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Attribute:</label>
                    <select id="roll-attribute" class="input-field" style="width: 100%;">
                        <option value="">None (Raw Roll)</option>
                        <option value="agility">Agility</option>
                        <option value="strength">Strength</option>
                        <option value="finesse">Finesse</option>
                        <option value="instinct">Instinct</option>
                        <option value="presence">Presence</option>
                        <option value="knowledge">Knowledge</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-difficulty" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Difficulty:</label>
                    <input type="number" id="roll-difficulty" class="input-field" value="12" min="1" max="30" style="width: 100%;">
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-context" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Context:</label>
                    <input type="text" id="roll-context" class="input-field" placeholder="Leap across the chasm..." style="width: 100%;">
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="roll-advantage">
                        <span style="color: var(--text-light);">With Advantage</span>
                    </label>
                </div>
                
                <button id="request-roll-btn" class="btn-primary" style="width: 100%;">
                    ğŸ² Request Roll
                </button>
                
                <div id="roll-status-panel" style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-medium); border-radius: 4px; display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong>Roll in Progress</strong>
                        <button id="cancel-roll-btn" class="btn-small" style="padding: 0.25rem 0.5rem;">âœ•</button>
                    </div>
                    <div>
                        <p style="color: var(--hope-color); margin-bottom: 0.25rem;">âœ“ Completed:</p>
                        <p id="completed-list" style="font-size: 0.9rem; margin-left: 1rem; color: var(--text-dim);">None</p>
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <p style="color: var(--fear-color); margin-bottom: 0.25rem;">â³ Pending:</p>
                        <p id="pending-list" style="font-size: 0.9rem; margin-left: 1rem; color: var(--text-dim);">None</p>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Area: Map View -->
        <main class="gm-main">
            <div class="control-panel">
                <h2>ğŸ—ºï¸ Game Map</h2>
                <canvas id="gm-canvas"></canvas>
            </div>
        </main>
        
        <!-- Right Sidebar: Players -->
        <aside class="gm-sidebar">
            <h2>ğŸ‘¥ Players</h2>
            <div class="player-list-gm" id="players-list-gm">
                <p class="empty-state">No players connected</p>
            </div>
            
            <div style="margin-top: 1.5rem;">
                <h2>ğŸ“œ Game Log</h2>
                <div id="event-log-gm" class="event-log-content" style="max-height: 300px; overflow-y: auto; background: var(--bg-medium); border-radius: 4px; padding: 0.5rem;">
                    <p class="empty-state">No events yet...</p>
                </div>
            </div>
        </aside>
    </div>

    <script src="/static/js/websocket.js?v=4"></script>
    <script src="/static/js/canvas.js?v=4"></script>
    <script src="/static/js/gm.js?v=4"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daggerheart VTT - GM View</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .gm-layout {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 1rem;
            height: 100vh;
            padding: 1rem;
        }
        
        .gm-sidebar {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .gm-main {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .control-panel {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .save-panel {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .saves-list {
            max-height: 200px;
            overflow-y: auto;
            background: var(--bg-medium);
            border-radius: 4px;
            padding: 0.5rem;
        }
        
        .save-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--bg-dark);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .save-item:hover {
            background: var(--accent);
            transform: translateX(4px);
        }
        
        .player-list-gm {
            margin-top: 1rem;
        }
        
        .player-item-gm {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: var(--bg-medium);
            border-radius: 4px;
            border-left: 4px solid var(--accent);
        }
        
        .player-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }
        
        .stat {
            background: var(--bg-dark);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.85rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-offline {
            background: #6b7280;
        }
    </style>
</head>
<body>
    <div class="gm-layout">
        <!-- Left Sidebar: Session Controls -->
        <aside class="gm-sidebar">
            <h2>üéÆ Session Control</h2>
            
            <div class="control-panel">
                <h3>Save/Load</h3>
                <div class="save-panel">
                    <button id="save-btn" class="btn-primary">üíæ Save</button>
                    <button id="refresh-saves-btn" class="btn-secondary">üîÑ</button>
                </div>
                
                <div class="saves-list" id="saves-list">
                    <p class="empty-state">No saves yet</p>
                </div>
            </div>
            
            <div class="control-panel" style="margin-top: 1rem;">
                <h3>Session Info</h3>
                <div id="session-info">
                    <p><strong>Players:</strong> <span id="player-count">0</span></p>
                    <p><strong>Characters:</strong> <span id="character-count">0</span></p>
                    <p><strong>Status:</strong> <span id="session-status">Active</span></p>
                </div>
            </div>
            
            <div class="control-panel" style="margin-top: 1rem;">
                <h3>Quick Actions</h3>
                <button id="clear-stress-all" class="btn-secondary btn-small" style="width: 100%; margin-bottom: 0.5rem;">Clear All Stress</button>
                <button id="refresh-clients" class="btn-secondary btn-small" style="width: 100%;">Refresh Clients</button>
            </div>
            
            <div class="control-panel" style="margin-top: 1rem;">
                <h3>üé≤ Request Roll</h3>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-target" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Target:</label>
                    <select id="roll-target" class="input-field" style="width: 100%;">
                        <option value="all">All Players</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-attribute" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Attribute:</label>
                    <select id="roll-attribute" class="input-field" style="width: 100%;">
                        <option value="">None (Raw Roll)</option>
                        <option value="agility">Agility</option>
                        <option value="strength">Strength</option>
                        <option value="finesse">Finesse</option>
                        <option value="instinct">Instinct</option>
                        <option value="presence">Presence</option>
                        <option value="knowledge">Knowledge</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-difficulty" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Difficulty:</label>
                    <input type="number" id="roll-difficulty" class="input-field" value="12" min="1" max="30" style="width: 100%;">
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label for="roll-context" style="display: block; margin-bottom: 0.25rem; color: var(--text-dim); font-size: 0.9rem;">Context:</label>
                    <input type="text" id="roll-context" class="input-field" placeholder="Leap across the chasm..." style="width: 100%;">
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="roll-advantage">
                        <span style="color: var(--text-light);">With Advantage</span>
                    </label>
                </div>
                
                <button id="request-roll-btn" class="btn-primary" style="width: 100%;">
                    üé≤ Request Roll
                </button>
                
                <div id="roll-status-panel" style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-medium); border-radius: 4px; display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong>Roll in Progress</strong>
                        <button id="cancel-roll-btn" class="btn-small" style="padding: 0.25rem 0.5rem;">‚úï</button>
                    </div>
                    <div>
                        <p style="color: var(--hope-color); margin-bottom: 0.25rem;">‚úì Completed:</p>
                        <p id="completed-list" style="font-size: 0.9rem; margin-left: 1rem; color: var(--text-dim);">None</p>
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <p style="color: var(--fear-color); margin-bottom: 0.25rem;">‚è≥ Pending:</p>
                        <p id="pending-list" style="font-size: 0.9rem; margin-left: 1rem; color: var(--text-dim);">None</p>
                    </div>
                </div>
            </div>

            <!-- Adversary Management Panel -->
            <div class="control-panel" style="margin-top: 1.5rem;">
                <h3>üëπ Adversaries</h3>
                
                <label for="adversary-template">Template:</label>
                <select id="adversary-template" style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; background: var(--bg-medium); color: var(--text-light); border: 1px solid var(--accent); border-radius: 4px;">
                    <option value="goblin">Goblin (HP: 3, Evasion: 10)</option>
                    <option value="bandit">Bandit (HP: 4, Evasion: 11)</option>
                    <option value="wolf">Wolf (HP: 3, Evasion: 12)</option>
                    <option value="orc_warrior">Orc Warrior (HP: 5, Evasion: 10)</option>
                    <option value="shadow_beast">Shadow Beast (HP: 4, Evasion: 13)</option>
                    <option value="ogre">Ogre (HP: 8, Evasion: 9)</option>
                    <option value="dragon_wyrmling">Dragon Wyrmling (HP: 10, Evasion: 12)</option>
                    <option value="custom">Custom...</option>
                </select>
                
                <button id="spawn-adversary-btn" class="btn-primary" style="width: 100%; margin-bottom: 0.75rem;">
                    ‚ûï Click Map to Spawn
                </button>
                
                <!-- Custom Adversary Panel (hidden by default) -->
                <div id="custom-adversary-panel" style="display: none; background: var(--bg-medium); padding: 0.75rem; border-radius: 4px; margin-bottom: 0.75rem;">
                    <h4 style="margin-top: 0;">Custom Enemy</h4>
                    
                    <label style="display: block; margin-bottom: 0.25rem;">Name:</label>
                    <input type="text" id="adv-name" value="Custom Enemy" style="width: 100%; padding: 0.25rem; margin-bottom: 0.5rem; background: var(--bg-dark); color: var(--text-light); border: 1px solid var(--accent); border-radius: 4px;">
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <div>
                            <label style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem;">HP:</label>
                            <input type="number" id="adv-hp" value="3" min="1" max="50" style="width: 100%; padding: 0.25rem; background: var(--bg-dark); color: var(--text-light); border: 1px solid var(--accent); border-radius: 4px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem;">Evasion:</label>
                            <input type="number" id="adv-evasion" value="10" min="5" max="20" style="width: 100%; padding: 0.25rem; background: var(--bg-dark); color: var(--text-light); border: 1px solid var(--accent); border-radius: 4px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <div>
                            <label style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem;">Armor:</label>
                            <input type="number" id="adv-armor" value="1" min="0" max="10" style="width: 100%; padding: 0.25rem; background: var(--bg-dark); color: var(--text-light); border: 1px solid var(--accent); border-radius: 4px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem;">Attack Mod:</label>
                            <input type="number" id="adv-attack-mod" value="1" min="-5" max="10" style="width: 100%; padding: 0.25rem; background: var(--bg-dark); color: var(--text-light); border: 1px solid var(--accent); border-radius: 4px;">
                        </div>
                    </div>
                    
                    <label style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem;">Damage Dice:</label>
                    <input type="text" id="adv-damage" value="1d6" placeholder="e.g., 1d8+2" style="width: 100%; padding: 0.25rem; margin-bottom: 0.5rem; background: var(--bg-dark); color: var(--text-light); border: 1px solid var(--accent); border-radius: 4px;">
                </div>
                
                <h4>Active Adversaries</h4>
                <div id="adversaries-list" style="max-height: 200px; overflow-y: auto; background: var(--bg-medium); border-radius: 4px; padding: 0.5rem;">
                    <p class="empty-state">No adversaries spawned</p>
                </div>
            </div>

            <!-- Combat Control Panel -->
            <div class="control-panel" style="margin-top: 1.5rem;">
                <h3>‚öîÔ∏è Combat</h3>
                
                <button id="start-combat-btn" class="btn-primary" style="width: 100%; margin-bottom: 0.5rem;">
                    ‚ñ∂Ô∏è Start Combat
                </button>
                <button id="end-combat-btn" class="btn-danger" style="width: 100%; display: none;">
                    üõë End Combat
                </button>
                
                <div id="combat-controls" style="display: none; margin-top: 1rem; padding: 0.75rem; background: var(--bg-medium); border-radius: 4px;">
                    <h4 style="margin-top: 0;">Action Tracker</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>PC Tokens: <strong id="pc-tokens">3</strong></span>
                        <span>Adversary: <strong id="adv-tokens">3</strong></span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <button id="add-pc-token" class="btn-small">+ PC</button>
                        <button id="add-adv-token" class="btn-small">+ Adversary</button>
                    </div>
                    
                    <button id="reset-tracker" class="btn-small" style="width: 100%;">Reset Tracker</button>
                </div>
            </div>
        </aside>
        
        <!-- Main Area: Map View -->
        <main class="gm-main">
            <div class="control-panel">
                <h2>üó∫Ô∏è Game Map</h2>
                <canvas id="gm-canvas"></canvas>
            </div>
        </main>
        
        <!-- Right Sidebar: Players -->
        <aside class="gm-sidebar">
            <h2>üë• Players</h2>
            <div class="player-list-gm" id="players-list-gm">
                <p class="empty-state">No players connected</p>
            </div>
            
            <div style="margin-top: 1.5rem;">
                <h2>üìú Game Log</h2>
                <div id="event-log-gm" class="event-log-content" style="max-height: 300px; overflow-y: auto; background: var(--bg-medium); border-radius: 4px; padding: 0.5rem;">
                    <p class="empty-state">No events yet...</p>
                </div>
            </div>
        </aside>
    </div>

    <script src="/static/js/websocket.js?v=5"></script>
    <script src="/static/js/canvas.js?v=5"></script>
    <script src="/static/js/gm.js?v=5"></script>
</body>
</html>
